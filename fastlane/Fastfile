require 'json'

default_platform(:ios)

package = JSON.parse(File.read('../package.json'))

platform :ios do
  desc "Push a new release build to the App Store"
  lane :release do
    match(type: "appstore", readonly: is_ci)
    increment_build_number(
      xcodeproj: "apps/mobile/ios/App/App.xcodeproj"
    )
    increment_version_number(
      version_number: package["version"],
      xcodeproj: "apps/mobile/ios/App/App.xcodeproj"
    )
    build_app(
        workspace: "apps/mobile/ios/App/App.xcworkspace",
        scheme: "App",
        output_directory: "apps/mobile/dist/ios",
        output_name: "lyricistant.ipa"
    )
    upload_to_app_store
  end
end
